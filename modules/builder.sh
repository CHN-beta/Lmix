source $stdenv/setup

shopt -s nullglob

modfile="$out/modules/$modName"
mkdir -p `dirname "$modfile"`

cat > $modfile << EOF
-- $modName
-- autogenerated by nix-with-modules

local pkgName = myModuleName()
local version = myModuleVersion()

EOF

addPaths () {
  if [[ -d $1/bin ]] ; then
    echo "local pkg = pathJoin(\"$1\", \"bin\")" >> $modfile
    echo -e "prepend_path(\"PATH\", pkg)\n" >> $modfile
  fi
  if [[ -d $1/share/man ]] ; then
    echo "local man = pathJoin(\"$1\", \"share\", \"man\")" >> $modfile
    echo -e "prepend_path(\"MANPATH\", man)\n" >> $modfile
  fi
}

for i in $buildInputs;
do
  addPaths $i
done
